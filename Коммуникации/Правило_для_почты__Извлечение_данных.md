**Извлечение данных** — второй блок [ правила обработки почты](../Задачи/Правила_создания_задач_по_e-mail.md), который необходимо заполнить при [ его создании](../Доступ и права/Создание_и_редактирование_правил.md). 


Извлекать данные можно из разных частей письма: 


  * Тема письма + Содержимого

  * Темы письма

  * Содержимого

  * Содержимого (исходного письма) — используйте этот вариант только если вы контролируете отправку письма, у вас есть его исходный текст до отправки, и вы проверяете регулярные выражения или другие способы извлечения данных на нём.


Данные извлекаются в инфоблоки, которым присваиваются понятные названия, чтобы в дальнейшем ими было удобно оперировать при заполнении полей задачи, контакта или аналитики. Помимо названия, каждый инфоблок содержит инструкцию по извлечению части письма, которая должна быть в него помещена: 


![AVrumL.png](images/AVrumL.png)


  


## Форматы извлечения данных


При извлечении данных ПланФикс может рассматривать письмо в одном из следующих вариантов: 


![z60Z1h.png](images/z60Z1h.png)


  


  * **Текст** — обычно соответствует тому, что видит в письме человек. Это наиболее распространенный вариант.

  * **HTML** — будет анализироваться все содержимое письма, включая разметку. Такой вариант позволяет использовать для более точного выделения нужного содержимого фрагменты, содержащие HTML-теги.

  * **HTML-Таблица** — используется для [разбора данных из таблиц](Извлечение_данных_из_таблиц_в_письмах.md), приходящих в письмах.

  * **JSON** — используется для разбора, если текст письма в формате JSON. Подробнее об этом читайте в справке про [ JSONPath](../Общие/JSONPath.md).

  * **XML** — используется для хранения и передачи данных, часто используется для передачи данных по [API](../Интеграции/API_ПланФикса.md).


## Способы выделения данных


Вы можете использовать один из доступных вариантов: 


![CQEume.jpg](images/CQEume.jpg)


  


  * **От метки до конца строки** — в инфоблок попадет фрагмент письма, начинающийся сразу за указанной вами меткой начала и закачивающийся символом перевода строки или окончанием письма. При этом начальные пробелы (если они есть) и символ перевода строки из выделенного таким образом текстового фрагмента в инфоблок не попадают.

  * **От метки до метки** — в инфоблок попадет фрагмент письма, начинающийся сразу за указанной вами меткой начала и закачивающийся последним символом перед началом метки конца. Начальные и конечные пробелы получившегося текстового фрагмента также игнорируются.

  * **Следующая строка от метки** — в инфоблок попадет фрагмент письма, начинающийся с новой строки относительно указанной вами метки. Начальные и конечные пробелы этой строки игнорируются.

  * **Регулярным выражением** — в инфоблок попадет фрагмент письма, выделенный при помощи введенного вами [ регулярного выражения](../Общие/Регулярные_выражения.md).

  * **Все содержимое** — в инфоблок попадает все содержимое письма.


## Примеры настройки


Представим, что в ПланФикс попадает письмо следующего содержания: 


![bZ4Lce.png](images/bZ4Lce.png)


  

Настройка инфоблока для извлечения номера телефона заказчика из этого письма: 


![MNjxFn.png](images/MNjxFn.png)


В результате отработки этой конструкции на приведенном выше примере, формируется инфоблок **Телефон** с содержимым **+75847842159**. 


Для извлечение произвольного количества строк заказа, перечисленных в письме, применяется следующая конструкция: 


![oDQdiP.png](images/oDQdiP.png)


В результате отработки этой конструкции на приведенном выше примере, формируется 3 инфоблока со следующим содержимым: 


  * **Наименование товара** : Зажим КС6, Фиксатор U-системы, Переходник N-P

  * **Цена товара** : 5400, 150, 390

  * **Количество товара** : 1, 5, 3


## Важно


  * В дальнейшем эти инфоблоки будут использованы для выбора и заполнения данными задач, контактов и аналитик в [ основной](Правило_для_почты__Основная_операция.md) и [ дополнительных](Правило_для_почты__Дополнительные_операции.md) операциях правила разбора почты (см. примеры в соответствующих статьях справки).

  * Поступающие в ПланФикс данные из почты перед дальнейшим использованием можно дополнительно [обработать](../Общие/Вычислить_инфоблок.md).
