В тестовом режиме поддерживается обмен данными с типовыми конфигурациями на базе 1С:Предприятие 8.3.


  

Сейчас между ПланФиксом и 1С поддерживается обмен контактами. Скачать файл модуля интеграции можно по [ссылке](https://github.com/planfix/planfix-1c/releases)


  


## Оглавление


  * Настройка интеграции

  * Настройка модуля

    * Настройка обмена контактами

    * Принципы работы обмена контактами

    * Выполнение обмена

  * Отладка, тестирование, доработка


  


## Поддерживаемые конфигурации


  * Управление торговлей 11

  * Комплексная автоматизация 2

  * Комплексная автоматизация для Беларуси 2

  * ERP Управление предприятием 2

  * Управление нашей фирмой 1.6

  * Бухгалтерия 3.0

  * УНФ для Украины 1.6


  


## Настройка интеграции


  * Перейдите в **Управление аккаунтом** — **Интеграции** — **Другие сервисы и приложения** — **1С:Предприятие 8** :


![BimIRJ.png](images/BimIRJ.png)


  


  * Нажмите кнопку **Добавить** :


![YPAcQV.png](images/YPAcQV.png)


  


  * Задайте и сохраните имя интеграции. Рекомендуем назвать её по имени типовой конфигурации, с которой будет производиться обмен:


![9mFgbC.png](images/9mFgbC.png)


  


  * Добавленная конфигурация должна появиться в перечне конфигураций:


![SS0Sf8.png](images/SS0Sf8.png)


  


Если в вашей конфигурации 1С включена опция «Дополнительные отчеты и обработки», то встроить модуль в интерфейс программы можно следующим образом: 


  * Перейдите в раздел **НСИ и Администрирование** — **Печатные формы, отчеты и обработки** :


![erWY2L.png](images/erWY2L.png)


  


  * Нажмите на **Дополнительные отчеты и обработки** :


![jzPhRb.png](images/jzPhRb.png)


  


  * Кликните на **Добавить из файла** , выберите файл обработки, загруженный по ссылке ранее:


![8lfPCV.png](images/8lfPCV.png)


  


  * Нажмите на кнопку **Записать** (иконка в виде дискеты).

  * Разместите обработку в нужном разделе программы.

  * Настройте быстрый доступ к команде **Открыть форму настроек обмена с ПланФикс** для пользователей:


![yQNC55.png](images/yQNC55.png)


![LqzFcJ.png](images/LqzFcJ.png)


  

В результате такой настройки, у выбранных пользователей в указанном разделе программы появится возможность открывать форму обработки: 


![tzHuwW.png](images/tzHuwW.png)


![1qTqjs.png](images/1qTqjs.png)


  

Второй вариант использования модуля. 


Открыть обработку через **Меню** — **Файл** — **Открыть**. В данном случае файл обработки должен храниться в локальной или общедоступной папке. 


  


## Настройка модуля интеграции


  * Скопируйте адрес для принятия запросов и токен авторизации из настроек Планфикса и вставьте их в настройки интеграции в 1С.

  * Нажмите **Тест подключения** , в сообщениях должно появиться — **Запрос успешно выполнен** :


![ialagW.png](images/ialagW.png)


  


## Настройка обмена контактами


  * Перейдите во вкладку **Контакты**.

  * Выберите шаблон для создания контакта в ПланФиксе.

  * Выберите шаблон для создания компании в ПланФиксе.

  * Установите опцию параметров импорта.

  * Выберите поле, по совпадению которого определяется, что контакт существует. Обратите внимание, это поле может быть пользовательским.

  * Укажите поле по умолчанию, которое будет использоваться, если контакт или компания не будут найдены по заданным ранее условиям.

  * Если в конфигурации используются контактные лица, то можно установить флаг выгрузки их в контакты компаний. Можно установить флаг выгрузки помеченных на удаление объектов:


![tMXneB.png](images/tMXneB.png)


  

В таблице слева при необходимости сопоставьте пользовательские поля ПланФикса с реквизитами справочника 1С. В зависимости от настроек CRM и маркетинга в 1С, используется справочник **Контрагенты** или справочник **Партнеры**. Это дополнительный функционал, настраивать сопоставление необязательно: 


![fkgvAk.png](images/fkgvAk.png)


  

В правой части окна располагаются параметры импорта контактов в 1С: 


  * Обновлять данные существующих контактов (если нужно).

  * Создавать при загрузке новых контрагентов/партнеров.

  * Опция, позволяющая создавать и обновлять контактные лица партнеров из контактов компаний в ПланФиксе.

  * Поля, по совпадению которых определяется, что компания/контакт существует.

  * Поле по умолчанию, если контакт/компания не найдены по заданному правилу выше:


![m5Pjss.png](images/m5Pjss.png)


  

Для правильного обмена телефонами, необходимо выполнить сопоставление видов телефонов для различных групп контактной информации в 1С: 


![bxVS1b.png](images/bxVS1b.png)


![PmGFHG.png](images/PmGFHG.png)


![eFEpeO.png](images/eFEpeO.png)


  

Не забудьте сохранить настройки. 


  


## Принципы работы обмена контактами


**Общие**


  * Контакты компаний из ПланФикс в 1С загружаются только как контактные лица для партнеров/контрагентов. Из 1С в ПланФикс выгружаются контактные лица только от партнеров/контрагентов, являющихся компаниями (юр. лицами).


  * Если в настройках включена опция «Выгружать объекты, помеченные на удаление», то при обмене, помеченный на удаление контакт в 1С, в ПланФикс будет перемещен в корзину. И будет удалено соответствие идентификаторов из базы данных для того, чтобы, если этот объект удалят из 1С, можно было сопоставлять контакт ПланФикса с другими объектами 1С (если его восстановят из корзины). Если же пометка на удаление снята, то при следующем обмене контакт восстанавливается из корзины, и сопоставление идентификаторов добавляется снова в базу данных.


  

**Управление небольшой фирмой (УНФ)**


  * Контакты компании — в 1С основное контактное лицо контрагента (компании) устанавливаем первое контактное лицо из списка контактов компаний в ПланФиксе.


  

**Управление торговлей, Комплексная автоматизация, ERP Управление предприятием**


  * Если в конфигурации установлена опция «Независимо вести партнеров и контрагентов», то в качестве основного справочника для обмена выступает справочник контрагентов. Информация из справочника партнеры добавляется к контрагенту по принципу — если наименование партнера и контрагента совпадают или схожи, и у партнера только один контрагент (одна сущность), тогда к данным контрагента добавляются данные партнера: день рождения партнёра и пол, доп/прочая информация. Аналогично происходит при обратном обмене: данные о дне рождении, поле и доп/прочая информация обновляются из контакта ПланФикса у партнера, который считается одной сущностью с контрагентом.


  * Если в 1С один партнер и несколько контрагентов у этого партнера — в ПланФикс будет выгружено несколько контактов, заполненных данными контрагентов. Если один из контрагентов определен как одна сущность с партнером, то по нему будут выгружены общие данные с партнером (день рождения партнёра, пол и доп/прочая информация). При обратной загрузке, данные партнера обновятся только из контакта, в который были выгружены данные партнера и контрагента как единой сущности (день рождения партнёра, пол и доп/прочая информация).


  

**Общие рекомендации и разъяснения**


  * Первый обмен контактами рекомендуется делать из 1С в ПланФикс, т. к. сопоставление и хранение связей данных между системами происходит на стороне ПланФикса. Это позволит минимизировать образование дублей.


  * Если вам понадобится контакт, который является контактным лицом компании как контрагент/партнер, необходимо его создать в 1С, тогда в ПланФикс он загрузится как отдельный контакт (дубль).


  


## Выполнение обмена


Перед выполнением обмена обязательно сделайте бэкап информационной базы.


  

Так как сопоставление и хранение информации о связи между объектами ПланФикса и базой 1С происходит на стороне ПланФикса, первым этапом рекомендуется выполнить выгрузку контактов в ПланФикс, нажав кнопку **Отправить данные**. Произойдет отправка всех контрагентов/партнеров/контактных лиц в ПланФикс, где будет произведен импорт согласно настроек. 


При первом обмене получите все данные из ПланФикса, нажав кнопку **Получить все данные**. При последующих обменах можно получать только измененные данные кнопкой **Получить данные (только измененные)**. 


При использовании механизма **Дополнительных обработок** , можно настроить автоматический обмен по расписанию, выбрав только выгрузку или загрузку, либо двусторонний обмен: 


![9vFWCr.png](images/9vFWCr.png)


  


## Отладка, тестирование, доработка


  * Исходный код модуля открыт для редактирования, поэтому при необходимости его можно дорабатывать. В этом случае последующие обновления модуля необходимо выполнять в ручном режиме.


  * Во вкладке **Отладка и тестирование** можно выполнять тестовые команды.
